<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montaña Rusa y Energía Mecánica</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            font-family: Arial, sans-serif;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100vh;
            background-color: #e0e0e0;
            object-fit: cover; /* Para que se ajuste bien sin distorsionarse */
        }

        .controls, .info {
            position: absolute;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            font-size: 14px;
            max-width: 300px;
            width: 90%;
            box-sizing: border-box;
        }

        .controls {
            top: 20px;
            right: 10px;
            max-width: 250px;
        }

        .info {
            top: 20px;
            left: 10px;
            max-width: 250px;
            display: none;
        }

        .btn {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin-right: 10px;
            width: 100%;
            box-sizing: border-box;
            margin-top: 5px;
        }

        .button-container {
            position: absolute;
            bottom: 20px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-around;
            width: 100%;
            box-sizing: border-box;
        }

        .energy-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            margin: 5px 0;
            box-sizing: border-box;
        }

        .energy-fill {
            height: 100%;
            text-align: right;
            color: white;
            padding-right: 5px;
        }

        @media screen and (max-width: 600px) {
            .controls {
                top: 10px;
                right: 10px;
                width: 90%;
                font-size: 12px;
            }
            .button-container {
                bottom: 10px;
                left: 10px;
                right: 10px;
                display: flex;
                justify-content: space-between;
            }
            .btn {
                padding: 8px 12px;
                width: 30%;
                font-size: 12px;
            }
            .info {
                width: 90%;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>

<canvas id="montanaRusa"></canvas>

<div class="controls">
    <label for="masa">Masa (kg):</label>
    <input type="range" id="masa" min="1" max="50" value="20" step="1">
    <span id="masaValue">20 kg</span><br><br>

    <label for="velocidad">Velocidad (m/s):</label>
    <input type="range" id="velocidad" min="1" max="30" value="10" step="0.5">
    <span id="velocidadValue">10 m/s</span><br><br>
    
    <label for="friccion">Coef. de Fricción:</label>
    <input type="range" id="friccion" min="0" max="1" value="0" step="0.01">
    <span id="friccionValue">0</span><br><br>

    <button class="btn" id="toggleEnergias">Mostrar Energías</button>
</div>

<div class="info" id="energyInfo">
    <p id="energiaPotencial">Energía Potencial: 0 J</p>
    <div class="energy-bar" id="energiaPotencialBar">
        <div class="energy-fill" id="energiaPotencialFill" style="width: 0%; background-color: blue;">0 J</div>
    </div>
    
    <p id="energiaCinetica">Energía Cinética: 0 J</p>
    <div class="energy-bar" id="energiaCineticaBar">
        <div class="energy-fill" id="energiaCineticaFill" style="width: 0%; background-color: green;">0 J</div>
    </div>
    
    <p id="energiaTotal">Energía Total: 0 J</p>
    <div class="energy-bar" id="energiaTotalBar">
        <div class="energy-fill" id="energiaTotalFill" style="width: 0%; background-color: red;">0 J</div>
    </div>
</div>

<div class="button-container">
    <button class="btn" id="reiniciar">Reiniciar</button>
    <button class="btn" id="pausar">Pausar</button>
    <button class="btn" id="reanudar">Reanudar</button>
</div>

<script>
    const canvas = document.getElementById('montanaRusa');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Definimos los puntos de la pista
    const puntosPistaBase = [
        {x: 0, y: 400}, // Tramo recto
        {x: 100, y: 400},
        {x: 200, y: 350},
        {x: 300, y: 200},
        {x: 400, y: 250},
        {x: 500, y: 150},
        {x: 600, y: 250},
        {x: 700, y: 200},
        {x: 800, y: 400}
    ];

    let puntosPista = []; // Para almacenar los puntos centrados

    let carritoX = puntosPistaBase[0].x;
    let carritoIndex = 0;
    let masa = 20;  // Valor predeterminado aumentado
    let velocidad = 10;  // Valor predeterminado aumentado
    let friccion = 0;  // Valor predeterminado de fricción en 0
    const g = 9.81;
    let animationId;
    let isPaused = false;

    function centrarPista() {
        const totalWidth = puntosPistaBase[puntosPistaBase.length - 1].x;
        const offsetX = (canvas.width - totalWidth) / 2;
        puntosPista = puntosPistaBase.map(p => ({ x: p.x + offsetX, y: p.y + 100 }));
    }

    function dibujarPista() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.moveTo(puntosPista[0].x, puntosPista[0].y);
        for (let i = 1; i < puntosPista.length; i++) {
            ctx.lineTo(puntosPista[i].x, puntosPista[i].y);
        }
        ctx.strokeStyle = 'brown';
        ctx.lineWidth = 5;
        ctx.stroke();
        
        ctx.fillStyle = 'red';
        ctx.fillRect(carritoX - 10, getCarritoY(carritoX) - 10, 20, 20);
    }

    function getCarritoY(x) {
        for (let i = 0; i < puntosPista.length - 1; i++) {
            if (x >= puntosPista[i].x && x <= puntosPista[i + 1].x) {
                const t = (x - puntosPista[i].x) / (puntosPista[i + 1].x - puntosPista[i].x);
                return puntosPista[i].y + t * (puntosPista[i + 1].y - puntosPista[i].y);
            }
        }
        return puntosPista[puntosPista.length - 1].y;
    }

    function calcularEnergia() {
        const altura = getCarritoY(carritoX);
        const energiaPotencial = masa * g * (400 - altura);
        const energiaCinetica = 0.5 * masa * Math.pow(velocidad, 2);
        const energiaTotal = energiaPotencial + energiaCinetica;

        document.getElementById('energiaPotencial').textContent = `Energía Potencial: ${energiaPotencial.toFixed(2)} J`;
        document.getElementById('energiaCinetica').textContent = `Energía Cinética: ${energiaCinetica.toFixed(2)} J`;
        document.getElementById('energiaTotal').textContent = `Energía Total: ${energiaTotal.toFixed(2)} J`;

        updateEnergyBar('energiaPotencialFill', energiaPotencial);
        updateEnergyBar('energiaCineticaFill', energiaCinetica);
        updateEnergyBar('energiaTotalFill', energiaTotal);
    }

    function updateEnergyBar(barId, energy) {
        const bar = document.getElementById(barId);
        const maxEnergy = masa * g * (400 - 0) + 0.5 * masa * Math.pow(10, 2);
        const percentage = Math.min((energy / maxEnergy) * 100, 100);
        bar.style.width = `${percentage}%`;
        bar.textContent = `${energy.toFixed(2)} J`;
    }

    function moverCarrito() {
        if (isPaused) return;

        if (carritoIndex < puntosPista.length - 1) {
            carritoX += velocidad;
            if (carritoX >= puntosPista[carritoIndex + 1].x) {
                carritoIndex++;
                velocidad -= friccion; // La fricción reduce la velocidad
            }
        }
        dibujarPista();
        calcularEnergia();
        if (carritoIndex < puntosPista.length - 1) {
            animationId = requestAnimationFrame(moverCarrito);
        }
    }

    document.getElementById('masa').addEventListener('input', (e) => {
        masa = parseFloat(e.target.value);
        document.getElementById('masaValue').textContent = `${masa} kg`;
    });

    document.getElementById('velocidad').addEventListener('input', (e) => {
        velocidad = parseFloat(e.target.value);
        document.getElementById('velocidadValue').textContent = `${velocidad} m/s`;
    });

    document.getElementById('friccion').addEventListener('input', (e) => {
        friccion = parseFloat(e.target.value);
        document.getElementById('friccionValue').textContent = friccion.toFixed(2);
    });

    document.getElementById('toggleEnergias').addEventListener('click', () => {
        const energyInfo = document.getElementById('energyInfo');
        energyInfo.style.display = energyInfo.style.display === 'block' ? 'none' : 'block';
    });

    document.getElementById('reiniciar').addEventListener('click', () => {
        masa = 20;
        velocidad = 10;
        friccion = 0;
        carritoX = puntosPista[0].x;
        carritoIndex = 0;
        document.getElementById('masa').value = masa;
        document.getElementById('velocidad').value = velocidad;
        document.getElementById('friccion').value = friccion;
        document.getElementById('masaValue').textContent = `${masa} kg`;
        document.getElementById('velocidadValue').textContent = `${velocidad} m/s`;
        document.getElementById('friccionValue').textContent = friccion.toFixed(2);
        calcularEnergia();
        dibujarPista();
    });

    document.getElementById('pausar').addEventListener('click', () => {
        isPaused = true;
    });

    document.getElementById('reanudar').addEventListener('click', () => {
        isPaused = false;
        moverCarrito();
    });

    centrarPista();
    dibujarPista();
    calcularEnergia();
</script>

</body>
</html>
